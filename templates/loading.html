<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Flask-SocketIO Test</title>
		<script type="text/javascript" src="//code.jquery.com/jquery-1.4.2.min.js"></script>
		<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>
		<script type="text/javascript" src= "/js/client.js"></script>
		<script type="text/javascript" src= "/js/phaser.js"></script>
		<script type="text/javascript" charset="utf-8">

	
			$(document).ready(function(){
			

				namespace = '/gameplay'; 
				var socket = io.connect('http://' + document.domain + ':' + location.port + namespace);
				var ready = false;
				
				
				/********************************************
				*	python server will return			 	*
				*	true if world finished generating		*
				********************************************/
				socket.on('ready response', function(msg) {
					if(msg.data == "True") 
						ready = true;
				});
				
				
				
				/********************************************
				*	change the view when gen finished    	*
				********************************************/
				socket.on('redirect', function (data) {
					window.location = data.url;
				});
				
			

				
				
				/********************************************
				*	keep checking that world is generated	*
				********************************************/ 
				function checkReady() {
					socket.emit('ready');
					if (!ready) {
						window.setTimeout(checkReady, 1000);
						console.log("Called checkReady(), !ready");
					} else {
						console.log("world is ready");
						socket.emit('change view');
					}
				}
				checkReady();
			});
			
		</script>
	</head>
	<body style = "padding:0px;margin:0px">
		<body>
			<p>World is generating...</p>
		</body>

	</body>
</html>
