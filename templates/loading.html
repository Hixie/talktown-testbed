<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Flask-SocketIO Test</title>
		<script type="text/javascript" src="//code.jquery.com/jquery-1.4.2.min.js"></script>
		<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>
		<script type="text/javascript" src= "/js/client.js"></script>
		<script type="text/javascript" src= "/js/phaser.js"></script>
		<script type="text/javascript" charset="utf-8">

/*
		All handlers and callbacks must be in this file
		No exposure to other files
*/
		

			
			$(document).ready(function(){
			

				namespace = '/gameplay'; 
				var socket = io.connect('http://' + document.domain + ':' + location.port + namespace);
				var ready = false;
				
				// event handler for returned game world info from server
				/*socket.on('return info', function(msg) {
					$('#log').append('<br>' + $('<div/>').text('Received #' + msg.count + ': JS received some info about: ' + msg.data).html());
				});
				
				// handler for posting a message
				// these send data to the server in a variety of ways
				$('form#emit').submit(function(event) {
					console.log("JAVASCRIPT: User wants to post this message: " + $('#emit_data').val());
					socket.emit('my event', {data: $('#emit_data').val()});
					return false;
				}); */
				
				
				/********************************************
				*	python server will return			 	*
				*	true if world finished generating		*
				********************************************/
				socket.on('ready response', function(msg) {
					if(msg.data == "True") 
						ready = true;
				});
				
				
				
				/********************************************
				*	change the view when gen finished    	*
				********************************************/
				socket.on('redirect', function (data) {
					console.log("3 three should redirect to" + data.url);
					window.location = data.url;
				});
				
			

				
				
				/********************************************
				*	keep checking that world is generated	*
				********************************************/ 
				function checkReady() {
					socket.emit('ready');
					if (!ready) {
						window.setTimeout(checkReady, 1000);
						console.log("Called checkReady(), !ready");
					} else {
						console.log("world is ready");
						console.log("1 One");
						//newGame();
						//game = new Phaser.Game(window.innerWidth, window.innerHeight, Phaser.AUTO, 'talktown', { preload: preload, create: create, update: update });
						socket.emit('change view');
						//requestWorldInfo();
					}
				}
				checkReady();
			});
			
		</script>
	</head>
	<body style = "padding:0px;margin:0px">
		<body>
			<p>World is generating...</p>
		</body>
		<!--<div id = "talktown" style="offset:0;width:100%;height:100%;margin:0;padding:0"></div>
		<body>
			<h1>Flask-SocketIO Test</h1>
			<h2>Send:</h2>
			<form id="emit" method="POST" action='#'>
				<input type="text" name="emit_data" id="emit_data" placeholder="Message">
				<input type="submit" value="Send a message">
			</form>
			<form id="disconnect" method="POST" action="#">
				<input type="submit" value="Disconnect">
			</form>
			<h2>Receive:</h2>
			<div id="log"></div>
		-->
	</body>
</html>
